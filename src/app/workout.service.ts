import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';

  
@Injectable({
  // we declare that this service should be created
  // by the root application injector.
 
  providedIn: 'root',
})
export class WorkoutService {

  public lapsSource = new Subject<Lap[]>();
  public selectTable:number;
  public nbLaps:number = 0;
  // activity icons
  public  typeIcon: Array<myIcone> = new Array<myIcone>();
  workout$ = this.lapsSource.asObservable();

  constructor() {
    let ic = new myIcone ();;
    ic = {
        viewbox:"0 0 10 10",
        path : "M21.490669535757153,7.771587645052615 c2.009027999676253,0 3.6527548328370347,-1.572832122779785 3.6527548328370347,-3.4952098011794326 C25.143424368594186,2.354082083813263 23.49969753543339,0.781249961033478 21.490669535757153,0.781249961033478 s-3.6527548328370347,1.572832122779785 -3.6527548328370347,3.4952098011794326 S19.481727146853448,7.771587645052615 21.490669535757153,7.771587645052615 z M31.53572392336585,20.878522001550824 v-3.4952098011794326 c-3.378800360643573,0 -6.300952860449662,-1.7475639414198523 -7.944679693610444,-4.281625862569325 L21.855970702272618,10.305649566202087 C21.21671506356368,9.257094817682232 20.029636091240377,8.645410574932404 18.751124813822518,8.645410574932404 c-0.45656225006491896,0 -0.9132101109023988,0.08740686848989754 -1.369772360967318,0.2621386871299644 l-9.588406526771225,3.757348488309397 v8.213706169518789 H11.445700758921005 v-5.854457985349111 l3.1961069719995554,-1.2232865671599233 l-2.830891416256644,14.068082236528168 L2.8617654266016226,26.208702612640007 L2.131248704343239,29.61650554532954 c0,0 12.784513498770778,2.359248184169678 12.784513498770778,2.446655052659575 L16.650835730596803,24.37373180273026 l3.9267093050304984,3.4952098011794326 v10.485547485198568 h3.6527548328370347 V25.16014786412015 L20.4861983413053,21.577613112790548 l1.0958178887738548,-5.242773742599284 C23.956259785498315,19.130958060130972 27.517667924013338,20.878522001550824 31.53572392336585,20.878522001550824 z",
        color: "#FFDA44"
    }
    this.typeIcon['Run'] = ic;
    ic = {
      viewbox: "-200 -200 512 512",
        path: "M29.055181993305876,8.559142750817934 c1.8467602488471275,0.9570964281702284 4.225279671049894,0.41230081988367373 5.309050478412237,-1.2141735527411583 c1.086588541018145,-1.6269398109915876 0.4710898455791799,-3.7214900344495483 -1.375670403267948,-4.677965878130772 c-1.849930199209904,-0.9566309898034738 -4.225719941933613,-0.4124559660059253 -5.310899616123858,1.2140184066189073 C26.59248277813607,5.508737268167758 27.20657260674713,7.60251176101446 29.055181993305876,8.559142750817934 z M35.393673852029565,20.330311765231524 c-0.21256278265946543,0 -0.4226600483701055,0.015049173858406904 -0.6312603930761016,0.028081448127542784 l-1.270709824589372,-5.5546190419135355 l0.41403073904921556,-0.1362958683980461 c0.9391858491490719,-0.30928379470859996 1.4170558663375208,-1.2309293339443337 1.0652794302461523,-2.0587890422789643 c-0.35168838191462476,-0.8285578658847637 -1.4041119023561865,-1.2476851151475077 -2.3361653631890116,-0.9378583090110277 l-4.56323160139249,1.5033659246181734 l-0.20437374422229476,-1.4633382250772566 c0.5547413134857633,-1.0234213954327949 0.4879081933372402,-2.3101257603265846 -0.4197542605375609,-3.217885721620798 c-1.8688618472098146,-1.8688901886429838 -4.14911280816653,-0.970283848561616 -4.859798068665514,-0.4635766132878333 l-9.411582627081312,6.714336305744377 l0.0014088668279003515,0.0018617534670194117 c-0.2922518126125789,0.224418865836965 -0.536161882192827,0.5030613014008698 -0.6921058292060475,0.8410471287260188 c-0.1929267012456042,0.4185842378348641 -0.22858864282683194,0.8585010674793253 -0.13771673242725938,1.270957033485251 c-0.7487246648522925,0.05189637789316609 -1.34326646622624,0.5873056457834985 -1.34326646622624,1.2602519510498889 c0,0.7047512603279725 0.6468459823597487,1.275301124908296 1.4469062322536592,1.278404047353328 l-0.5985042393274175,1.2338771102671144 c-0.7590270035313139,-0.1912175956751187 -1.556269519769424,-0.29989745431237697 -2.3832743477469296,-0.29989745431237697 C4.679408407857741,20.330311765231524 0.7812500034109604,23.76307486617081 0.7812500034109604,27.98304939141482 c0,4.220207244427374 3.8981584044467823,7.653590929855668 8.688129510954482,7.653590929855668 c4.79041137739142,0 8.686720644126583,-3.433383685428294 8.686720644126583,-7.653590929855668 c0,-2.8103168584657996 -1.7331703608476625,-5.264650939425262 -4.302150967347205,-6.595571949160762 l0.9648096145815084,-1.9899041639992459 h1.5644585582065946 l5.307993828291312,1.897592221259534 l-2.835432545326198,4.093763154792305 c-0.730585504443076,1.0559245080445085 -0.35168838191462476,2.43439780425013 0.8466409093913669,3.07848693077772 c0.41306214310503403,0.22185895481981324 0.8697991578749784,0.3280564755010454 1.320812651156578,0.3280564755010454 c0.8566790855401569,0 1.693634035489709,-0.3823576182891113 2.1729129195060586,-1.0734560198589413 l2.5834214914855225,-3.730876374845771 l1.6793692588572169,0.8929435066191843 c-0.4796311007233253,0.9484858183852641 -0.7519826693918118,1.9956445705225556 -0.7519826693918118,3.09904379197606 c0,4.220207244427374 3.8967495376188803,7.653590929855668 8.686720644126583,7.653590929855668 c4.790323323214678,0 8.687072860833558,-3.433383685428294 8.687072860833558,-7.653590929855668 C44.0807467128631,23.76307486617081 40.18399717524422,20.330311765231524 35.393673852029565,20.330311765231524 zM9.469379514365443,33.71701735065122 c-3.5887360273691664,0 -6.509228907429849,-2.5724002799929435 -6.509228907429849,-5.733967959236405 c0,-3.1615676792434613 2.9204928800606815,-5.7333473747473995 6.509228907429849,-5.7333473747473995 c0.52339402656498,0 1.0257431048881984,0.06950546276872477 1.5134751898719512,0.17252248794379882 l-1.802997323005473,3.715206616498358 c-1.0353410101532698,0.1255907859626844 -1.8353132058704373,0.8996923629371303 -1.8353132058704373,1.845618270305242 c0,1.0335058933791499 0.9516895422466863,1.8719931110880172 2.1247472848272153,1.8719931110880172 c0.7719709675126487,0 1.4411827107653146,-0.3680841750419627 1.8129474449775196,-0.9122591988395113 h4.584540712164483 C15.344970565947111,31.647135360631264 12.685118049047993,33.71701735065122 9.469379514365443,33.71701735065122 zM15.866867671507444,27.02339305222743 h-4.584540712164483 c-0.03125923274403906,-0.045612959941975596 -0.06234235713459054,-0.09122591988395112 -0.09791624453907444,-0.13435654186990095 l1.802997323005473,-3.715827200987365 C14.489436184704624,24.028529881343335 15.556124481778674,25.41080425754412 15.866867671507444,27.02339305222743 zM26.914056631604325,22.352874187964737 l0.6750233189177558,-0.9746279399846611 c0.38884724450049685,-0.5610859511229747 0.47822223389542506,-1.2441167543357212 0.2442622862872234,-1.868269604153978 c-0.23431216431517723,-0.6241528498182572 -0.7676563128522034,-1.1259729822411138 -1.4583532752303499,-1.373353474171318 l-4.642656468815374,-1.6596756427866783 l2.8567416560981904,-2.038697619447379 l0.1588497348457647,1.1396258409992563 c0.06656895761829162,0.4861503740754436 0.3844445356633083,0.9185426167907015 0.8594968191959574,1.172904684222228 c0.2880252121288779,0.1536722340902273 0.6145300994947838,0.23178830664391667 0.9420035828048717,0.23178830664391667 c0.2144119203710846,0 0.42970438250960696,-0.03374428158972686 0.6355750477365456,-0.1013104178303063 l4.239808610212616,-1.3963926733256833 l1.1999142664873792,5.250998080667119 c-1.6085737007552245,0.4780052026572336 -3.0041443479672654,1.3583043003129112 -4.037107895348452,2.506695897219384 L26.914056631604325,22.352874187964737 zM33.83643573631595,26.03433652287337 l-3.3463228787935626,-1.7795260222260527 c0.6936027502106915,-0.7073111713451243 1.5662196417414707,-1.2659147845120728 2.5716222318018573,-1.608399849382519 L33.83643573631595,26.03433652287337 zM35.393673852029565,33.71701735065122 c-3.5888240815459103,0 -6.507820040601948,-2.5724002799929435 -6.507820040601948,-5.733967959236405 c0,-0.7403572953847194 0.17302645730151192,-1.442626217756665 0.4638694030861905,-2.0931539083576975 l3.9220210863443437,2.085784467550746 c0,0.0024823379560258824 -0.0014088668279003515,0.004964675912051766 -0.0014088668279003515,0.0073694408069518436 c0,1.0335058933791499 0.9516895422466863,1.8719931110880172 2.1233384179993147,1.8719931110880172 c1.1730577425805289,0 2.12369063470629,-0.8385647907699928 2.12369063470629,-1.8719931110880172 c0,-0.8128105344762244 -0.591812121894891,-1.4977030911559892 -1.4141500785049768,-1.75625410388831 l-0.9049327743957445,-3.9595617590446555 c0.06656895761829162,-0.0018617534670194117 0.12882326057613835,-0.017531511814432816 0.1954802723711737,-0.017531511814432816 c3.5888240815459103,0 6.508172257308923,2.571779695503937 6.508172257308923,5.7333473747473995 C41.90184610933848,31.144617070658278 38.98249793357546,33.71701735065122 35.393673852029565,33.71701735065122 z",
        color: "#006DF0"
    }
    this.typeIcon['Ride'] = ic;
    ic = {
      viewbox:"0 0 10 10",
        path: "M18.79091539280164,9.354143310977662 l-6.999359533063032,5.0498818469644 c0.6676007758519874,0.18645807232095635 1.2060829380165872,0.4117372979806115 1.6583514206745191,0.6059887350431086 c0.7968203423256821,0.3496088856017931 1.2813937166020375,0.5593742169628688 2.4766747064837147,0.5593742169628688 c1.1952809898816767,0 1.6798543641580321,-0.20976533136107586 2.4766747064837147,-0.5515808522213287 c0.9691467485527109,-0.4195306627221522 2.304449253042993,-1.0022121387251404 4.695011232806347,-1.0022121387251404 s3.7258644842536346,0.5748881112614485 4.695011232806347,1.0022121387251404 c0.7968203423256821,0.3496088856017931 1.2813937166020375,0.5515808522213287 2.4766747064837147,0.5515808522213287 c1.1952809898816767,0 1.6798543641580321,-0.20976533136107586 2.4766747064837147,-0.5515808522213287 c0.25843913294739024,-0.11653629520059801 0.5491831575132029,-0.23307259040119593 0.8722320736974398,-0.35740225034333334 L19.8246719245912,4.692691502953753 C16.475664191623736,2.27645709233836 13.406699487873484,1.5695187915777356 8.022584535731639,1.5850326858763153 v3.884518894958423 c3.919693833964178,-0.015513894298579623 6.213341138872258,0.6059887350431086 8.614604113984216,2.330725904011954 L18.79091539280164,9.354143310977662 z M42.13655008478707,18.902326152685138 c-0.9691467485527109,-0.4273240274636926 -2.304449253042993,-1.0022121387251404 -4.695011232806347,-1.0022121387251404 s-3.7258644842536346,0.5826814760029888 -4.695011232806347,1.0022121387251404 c-0.7968203423256821,0.34181552086025313 -1.2813937166020375,0.5515808522213287 -2.4766747064837147,0.5515808522213287 c-1.1952809898816767,0 -1.6798543641580321,-0.20197196661953642 -2.4766747064837147,-0.5515808522213287 c-0.9691467485527109,-0.4273240274636926 -2.304449253042993,-1.0022121387251404 -4.695011232806347,-1.0022121387251404 s-3.7258644842536346,0.5826814760029888 -4.695011232806347,1.0022121387251404 c-0.7968203423256821,0.34181552086025313 -1.2813937166020375,0.5515808522213287 -2.4766747064837147,0.5515808522213287 c-1.2060829380165872,0 -1.6906563122929426,-0.20976533136107586 -2.487476654618625,-0.5593742169628688 c-0.9691467485527109,-0.4195306627221522 -2.304449253042993,-0.9944187739836003 -4.695011232806347,-0.9944187739836003 s-3.7258644842536346,0.5748881112614485 -4.695011232806347,0.9944187739836003 c-0.8076222904605925,0.3496088856017931 -1.292195664736948,0.5593742169628688 -2.487476654618625,0.5593742169628688 v3.107658817077439 c2.3905619797633535,0 3.7258644842536346,-0.5748881112614485 4.695011232806347,-0.9944187739836003 c0.8076222904605925,-0.3496088856017931 1.2813937166020375,-0.5593742169628688 2.487476654618625,-0.5593742169628688 s1.6906563122929426,0.20976533136107586 2.487476654618625,0.5593742169628688 c0.9691467485527109,0.4195306627221522 2.304449253042993,0.9944187739836003 4.695011232806347,0.9944187739836003 s3.7258644842536346,-0.5748881112614485 4.716514176289861,-1.0022121387251404 c0.7968203423256821,-0.34181552086025313 1.2813937166020375,-0.5515808522213287 2.4766747064837147,-0.5515808522213287 c1.1952809898816767,0 1.6798543641580321,0.20197196661953642 2.4766747064837147,0.5515808522213287 c0.9691467485527109,0.4273240274636926 2.304449253042993,1.0022121387251404 4.695011232806347,1.0022121387251404 c2.3905619797633535,0 3.7258644842536346,-0.5826814760029888 4.695011232806347,-1.0022121387251404 c0.7968203423256821,-0.34181552086025313 1.2813937166020375,-0.5515808522213287 2.4766747064837147,-0.5515808522213287 c1.1952809898816767,0 1.6798543641580321,0.20976533136107586 2.4766747064837147,0.5515808522213287 c0.9691467485527109,0.4273240274636926 2.304449253042993,1.0022121387251404 4.695011232806347,1.0022121387251404 v-3.107658817077439 C43.439547697658924,19.453907004906462 42.95497432338256,19.244141673545386 42.13655008478707,18.902326152685138 z M37.44153885198072,24.89229172599585 c-2.3905619797633535,0 -3.7258644842536346,0.5826814760029888 -4.695011232806347,1.0022121387251404 c-0.7968203423256821,0.34181552086025313 -1.2813937166020375,0.5515808522213287 -2.4766747064837147,0.5515808522213287 c-1.1952809898816767,0 -1.6798543641580321,-0.20197196661953642 -2.4766747064837147,-0.5515808522213287 c-0.9691467485527109,-0.4273240274636926 -2.304449253042993,-1.0022121387251404 -4.695011232806347,-1.0022121387251404 s-3.7258644842536346,0.5826814760029888 -4.695011232806347,1.0022121387251404 c-0.7968203423256821,0.34181552086025313 -1.2813937166020375,0.5515808522213287 -2.4766747064837147,0.5515808522213287 c-1.2060829380165872,0 -1.6906563122929426,-0.20976533136107586 -2.487476654618625,-0.5593742169628688 c-0.9691467485527109,-0.4195306627221522 -2.304449253042993,-0.9944187739836003 -4.695011232806347,-0.9944187739836003 s-3.7258644842536346,0.5748881112614485 -4.695011232806347,0.9944187739836003 c-0.8076222904605925,0.3496088856017931 -1.292195664736948,0.5593742169628688 -2.487476654618625,0.5593742169628688 v3.107658817077439 c2.3905619797633535,0 3.7258644842536346,-0.5748881112614485 4.695011232806347,-0.9944187739836003 c0.8076222904605925,-0.3496088856017931 1.2813937166020375,-0.5593742169628688 2.487476654618625,-0.5593742169628688 s1.6906563122929426,0.20976533136107586 2.487476654618625,0.5593742169628688 c0.9691467485527109,0.4195306627221522 2.304449253042993,0.9944187739836003 4.695011232806347,0.9944187739836003 s3.7258644842536346,-0.5748881112614485 4.716514176289861,-1.0022121387251404 c0.7968203423256821,-0.34181552086025313 1.2813937166020375,-0.5515808522213287 2.4766747064837147,-0.5515808522213287 c1.1952809898816767,0 1.6798543641580321,0.20197196661953642 2.4766747064837147,0.5515808522213287 c0.9691467485527109,0.4273240274636926 2.304449253042993,1.0022121387251404 4.695011232806347,1.0022121387251404 c2.3905619797633535,0 3.7258644842536346,-0.5826814760029888 4.695011232806347,-1.0022121387251404 c0.7968203423256821,-0.34181552086025313 1.2813937166020375,-0.5515808522213287 2.4766747064837147,-0.5515808522213287 c1.1952809898816767,0 1.6798543641580321,0.20976533136107586 2.4766747064837147,0.5515808522213287 c0.9691467485527109,0.4273240274636926 2.304449253042993,1.0022121387251404 4.695011232806347,1.0022121387251404 v-3.107658817077439 c-1.1952809898816767,0 -1.6798543641580321,-0.20976533136107586 -2.498278602753535,-0.5515808522213287 C41.16740333623435,25.467179837257298 39.83210083174407,24.89229172599585 37.44153885198072,24.89229172599585 z M 30.19, 4.84 m -3.82, 0 a 3.82,3.82 0 1,0 7.64,0 a 3.82,3.82 0 1,0 -7.64,0",
        color: "#91DC5A"
    }
    this.typeIcon['Swim'] = ic;
  }

  pushWorkout(laps: Lap[], selectTable:number) {
    const rows = [];
    this.selectTable = selectTable;
    laps.forEach(element => {rows.push(element, { detailRow: true, element })});
    this.nbLaps = rows.length /2;
    this.lapsSource.next(rows);
  }

  getStandardDate (date: string) {

    let tmpTime = date.split(':');
    let hh = tmpTime[0].padStart(2, '0')
    let mm = tmpTime[1].padStart(2, '0')
    let ss = tmpTime[2].padStart(2, '0')
    return (hh+':'+mm+':'+ss);
  }
  
}

export class myIcone {
  path: string;
  color: string;
  viewbox: string;
}

export class Gps {
  gps_index: number;
  gps_lat: number;
  gps_long: number;
  gps_time: number;
  strokeWeight: number;
  color: string;
}

export class Heartrate {
  hr_value: number;
}

export class Activity {
  time: string;
  distance: number;
  resolution: number;
  type: string;
}

export class Split {
  split_index: number;
  split_distance: number;
  split_time: string;
 }

export class Lap {
  lap_index: number;
  lap_start_index: number;
  lap_end_index: number;
  lap_distance: number;
  lap_time: string;
  lap_start_date: string;
  lap_cumulatedTime: string;
  lap_average_speed: number;
  lap_average_HR: number;
  lap_average_cadence: number;
  lap_pace_zone: number;
  lap_total_elevation_gain: number;
  lap_start: number;
  lap_end:number;
  lap_slope: number;
  band: any;
}

export class infos {
  total_dist: number;
  total_time: string;
  average_time: string;
  average_speed: string;
  average_HR: number;
  slope: number;
  elevation: number;
  nbValues: number;
  show: boolean;
}

export class Workout {
  name: string="fli";
  dayTime: string;
  actId: number;
  act: Activity;
  loaded : boolean = false;
  lap: Lap[];
  splits: Split[];
  watchLaps: Lap[];
  splitLaps: Lap[];
  customlaps: Lap[];
  gpsCoord: Gps[];
  heartrate: Heartrate[];
  constructor() {}
}

export interface lapSelection {
  lap_idx: number;
  isCurrent: boolean;
  toClear: boolean;
  toRemove: boolean;
}

export interface Login {
  firstname: string;
  lastname: string;
}

export class ActivityItem {
  wid: number;
  label: string;
  strTime: string;
  strDist: string;
  time: string;
  type: string;
  devMode: boolean;
}